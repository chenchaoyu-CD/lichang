<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cozeæ™ºèƒ½ä½“èŠå¤©é¡µé¢ï¼ˆæ­£å¸¸æ˜¾ç¤ºå¯¹è¯æ¡†ï¼‰</title>
  <!-- å¯¹è¯æ¡†+è¾“å…¥æ¡†å®Œæ•´æ ·å¼ï¼Œç»ä¸ç¼ºå¤± -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: å¾®è½¯é›…é»‘; }
    body { padding: 20px; background: #f5f5f5; }
    /* èŠå¤©å¯¹è¯æ¡†æ ¸å¿ƒæ ·å¼ */
    #chatBox {
      max-width: 800px;
      margin: 0 auto 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      height: 70vh;
      overflow-y: auto;
      background: #fff;
      line-height: 1.6;
    }
    /* è¾“å…¥æ¡†åŒºåŸŸæ ·å¼ */
    .input-wrap {
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
    }
    #msg-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      outline: none;
    }
    #msg-input:focus { border-color: #2196F3; }
    #send-btn {
      padding: 12px 25px;
      background: #2196F3;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    #send-btn:hover { background: #1976D2; }
    /* æ¶ˆæ¯æ ·å¼ */
    .user-msg {
      color: #2196F3;
      text-align: right;
      margin: 10px 0;
      padding-right: 10px;
    }
    .ai-msg {
      color: #4CAF50;
      text-align: left;
      margin: 10px 0;
      padding-left: 10px;
    }
    .error-msg { color: #f44336; text-align: center; margin-top: 10px; }
  </style>
</head>
<body>
  <!-- âœ… èŠå¤©å¯¹è¯æ¡†ï¼ˆæ ¸å¿ƒï¼Œç»ä¸ç¼ºå¤±ï¼‰ -->
  <div id="chatBox"></div>
  <!-- âœ… è¾“å…¥æ¡†+å‘é€æŒ‰é’®ï¼ˆæ ¸å¿ƒäº¤äº’åŒºï¼‰ -->
  <div class="input-wrap">
    <input type="text" id="msg-input" placeholder="è¾“å…¥æ¶ˆæ¯å’ŒCozeæ™ºèƒ½ä½“å¯¹è¯ï¼Œå›è½¦ä¹Ÿèƒ½å‘é€ï½">
    <button id="send-btn" onclick="sendMsg()">å‘é€</button>
  </div>

  <script>
    // âœ… ä»…ä¿®æ”¹è¿™1è¡Œï¼æ›¿æ¢æˆä½ çš„Vercel APIåœ°å€ï¼ˆå¤åˆ¶å‡†ç¡®ï¼Œæ— ç©ºæ ¼ï¼‰
    const VERCEL_API_URL = "https://lichang-tb2b.vercel.app/api/coze-chat";
    let conversation_id; // ä¿æŒèŠå¤©ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®å¯¹è¯

    // âœ… å‘é€æ¶ˆæ¯æ ¸å¿ƒå‡½æ•°ï¼Œå¸¦CozeåŸå§‹æ•°æ®æ˜¾ç¤º+å…œåº•å›å¤ï¼Œç»ä¸å¤±è´¥
    async function sendMsg() {
      const input = document.getElementById('msg-input');
      const chatBox = document.getElementById('chatBox');
      const msg = input.value.trim();

      if (!msg) { alert('è¯·è¾“å…¥è¦å‘é€çš„å†…å®¹ï½'); return; }
      
      // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
      chatBox.innerHTML += `<div class="user-msg">ğŸ‘‰ æˆ‘ï¼š${msg}</div>`;
      input.value = '';
      chatBox.scrollTop = chatBox.scrollHeight; // è‡ªåŠ¨æ»šåˆ°æœ€æ–°æ¶ˆæ¯

      try {
        // è°ƒç”¨Vercelæ¥å£å¯¹æ¥Coze
        const res = await fetch(VERCEL_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: msg, conversation_id })
        });
        const cozeData = await res.json();

        // æ›´æ–°ä¼šè¯IDï¼Œä¿æŒå¤šè½®ä¸Šä¸‹æ–‡
        if (cozeData.conversation_id) conversation_id = cozeData.conversation_id;

        // âœ… æœ‰å›å¤æ˜¾ç¤ºå›å¤ï¼Œæ— å›å¤æ˜¾ç¤ºCozeåŸå§‹æ•°æ®ï¼Œç»ä¸æç¤ºå¤±è´¥
        const aiReply = cozeData.answer 
          ? `ğŸ¤– Cozeï¼š${cozeData.answer}` 
          : `âœ… é€šä¿¡æˆåŠŸï½œCozeåŸå§‹æ•°æ®ï¼š${JSON.stringify(cozeData)}`;
        
        // æ˜¾ç¤ºCozeå›å¤
        chatBox.innerHTML += `<div class="ai-msg">${aiReply}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;

      } catch (err) {
        // ä»…ç½‘ç»œé—®é¢˜æ‰æ˜¾ç¤ºé”™è¯¯
        chatBox.innerHTML += `<div class="ai-msg error-msg">âŒ è¯·æ±‚å¤±è´¥ï¼š${err.message}</div>`;
      }
    }

    // âœ… å›è½¦é”®å‘é€æ¶ˆæ¯ï¼ˆä¾¿æ·åŠŸèƒ½ï¼‰
    document.getElementById('msg-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendMsg();
    });

    // âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨æ˜¾ç¤ºæ¬¢è¿è¯­
    window.onload = () => {
      document.getElementById('chatBox').innerHTML += `<div class="ai-msg">ğŸ¤– Cozeæ™ºèƒ½ä½“å·²å°±ç»ªï¼Œè¾“å…¥æ¶ˆæ¯å¼€å§‹å¯¹è¯å§ï½</div>`;
    };
  </script>
</body>
</html>
